<!DOCTYPE html>
<html>

<head>
  <div>
    <title>Choropleth D3</title>

    <h3>Recession Toggle</h3>
    <label class="switch">
  <input type="checkbox"  onchange="mapSwap(this)">
  <div class="slider round"></div>

</label>
  </div>

  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <!--<svg preserveAspectRatio="xMidYMid meet"></svg>-->

  <style type="text/css">
    svg {
      font: 10px sans-serif;
    }
    
    svg .myrect:hover {
      fill: red;
    }
    
    svg .text {
      fill: black;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .switch input {
      display: none;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    input:checked+.slider {
      background-color: #2196F3;
    }
    
    input:focus+.slider {
      box-shadow: 0 0 1px #2196F3;
    }
    
    input:checked+.slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }
    
    .slider.round {
      border-radius: 34px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }
  </style>

  <script type="text/javascript">
    function mapSwap(checkbox) {
      document.getElementById("map").innerHTML = "";
      document.getElementById("bars").innerHTML = "";
      if (checkbox.checked) {
        csvName = "avgFundedAfterCSV3.csv";
        loadData2(csvName);
      }
      else {
        csvName = "avgFundedBeforeCSV3.csv";
        loadData2(csvName);
      }
    }
    var csvName = "avgFundedBeforeCSV3.csv";
    var myPaths;
    var margin = { top: 10, right: 0, bottom: 30, left: 0 };
    var svgWidth = 800 - margin.left - margin.right;
    var svgHeight = 500 - margin.top - margin.bottom;

    loadData2(csvName);

    function loadData2(csvName) {
      d3.csv(csvName, function (err, data) {
        myData = data;
        createChoroplethMap(myData);
      });
    }

    function createChoroplethMap(myData) {

      d3.json("us-10m.json", function (json) {
        myPaths = json;
        var svg = d3.select("#map")
          .append("svg")
          // .attr("width", function () {
          //   return document.getElementById('map').offsetWidth;          
          // })
          // .attr("height", function () {
          //   return document.getElementById('map').offsetHeigth;          
          // })
          .attr("width", 761)
          .attr("height", 470)
          .append("g")
        //.attr("transform", "translate(" + 0 + "," + 0 + ")");
        var projection = d3.geoAlbersUsa()
          .translate([svgWidth / 2, svgHeight / 2])
          .scale([1000]);
        var path = d3.geoPath()
          .projection(projection);
        var states = svg.selectAll("path")
          .data(topojson.feature(myPaths, myPaths.objects.states).features)
          .enter()
          .append("path")
          .attr("d", path)
          .attr("fill", function (d) {
            if ((myData[parseInt(d.id) - 1]) == null) {
              return d3.hsl(320, 1, .5);
            }
            else {
              return d3.hsl(220, 1,
                d3.scaleLinear().domain([13000, 0])(myData[parseInt(d.id) - 1].Avg.replace(/,/g, "")));
            }
          }
          )
          .style("stroke", "black")
          .on("mouseover", function (d) {
            d3.select(this)
              .attr("fill", "gray");
          })
          .on("mouseleave", function (d) {
            d3.select(this)
              .attr("fill", function (d) {
                if ((myData[parseInt(d.id) - 1]) == null) {
                  return d3.hsl(320, 1, .5);
                }
                else {
                  return d3.hsl(220, 1, d3.scaleLinear().domain([13000, 0])(myData[parseInt(d.id) - 1].Avg.replace(/,/g, "")));
                }
              }
              )
          })
          .on("click", function (d) {
            console.log(myData[parseInt(d.id) - 1].Avg)
          }
          );

      });
      createBars(myData);
    }


    function createBars(myData) {
      // var margin = { top: 0, right: 0, bottom: 0, left: 0 },
      //   width = 300 - margin.left - margin.right,
      //   height = 600 - margin.top - margin.bottom;
      // var x = d3.scaleBand()
      //   .range([0, width])
      //   .padding(0.1);
      // var y = d3.scaleLinear()
      //   .range([height, 0]);
      // var svg = d3.select("#bars").append("svg")
      //   .attr("id", "theseBars")
      //   .attr("width", width + margin.left + margin.right)
      //   .attr("height", height + margin.top + margin.bottom)
      //   .append("g")
      //   .attr("transform",
      //   "translate(" + margin.left + "," + margin.top + ")");
      // x.domain(1,57);
      // y.domain([0,0.2]);
      // // append the rectangles for the bar chart
      // svg.selectAll(".bar")
      //   .data(myData)
      //   .enter().append("rect")
      //   .attr("id", "theseBars")
      //   .attr("class", "bar")
      //   .attr("fill", d3.hsl(250, .5, .5))
      //   // .attr("x", function (d) { if(myData[parseInt(d.id) - 1] == null){return 50;}else{return x(myData[parseInt(d.id) - 1].rate.State_Code); }})
      //   .attr("width", x.bandwidth())
      //   // .attr("y", function (d) { if(myData[parseInt(d.id) - 1] == null){return 50;}else{return y(myData[parseInt(d.id) - 1].rate); }})
      //   .attr("height", function (d) { if(myData[parseInt(d.id) - 1] == null){return 0;}else{return height - y(myData[parseInt(d.id) - 1].rate); }})
      // // .filter(function(d){ 
      // //   if(d.State_Code == 2){
      // //   return d.Amount;
      // //   }})
      // //.append("text", function(d) { return x(d.Damage_Descp); });
      // // add the x Axis
      // svg.append("g")
      //   .attr("id", "theseBars")
      //   .attr("transform", "translate(0," + height + ")")
      //   .call(d3.axisBottom(x))
      //   .selectAll("text")
      //   .style("text-anchor", "end")
      //   .attr("dx", "-.8em")
      //   .attr("dy", ".15em")
      //   .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
      //   // .attr("transform", "rotate(275)");
      // // add the y Axis
      // svg.append("g")
      //   .attr("id", "theseBars")
      //   .call(d3.axisLeft(y));
      // // var WIDTH = 600, HEIGHT = 400;
      // // var COLOR_COUNTS = 9;
      // // var SCALE = 0.7;
      // //something = data;

      // set the dimensions and margins of the graph
      var margin = { top: 10, right: 0, bottom: 30, left: 30 },
        width = 750 - margin.left - margin.right,
        height = 470 - margin.top - margin.bottom;

      // set the ranges
      var x = d3.scaleBand()
        .range([0, width])
        .padding(0.1);
      var y = d3.scaleLinear()
        .range([height, 0]);

      // append the svg object to the body of the page
      // append a 'group' element to 'svg'
      // moves the 'group' element to the top left margin
      var svg = d3.select("#bars").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");


      // Scale the range of the data in the domains
      //console.log(myData)
      x.domain(
        myData.map(
          function (d) {
            //console.log(d)
            return d.State_Code;
          }
        )
      );
      y.domain([.075, .18]);

      // append the rectangles for the bar chart
      svg.selectAll(".bar")
        .data(myData)
        .enter().append("rect")
        .attr("class", "bar")
        .attr("x", function (d) { return x(d.State_Code); })
        .attr("width", x.bandwidth())
        .attr("y", function (d) { return y(d.rate); })
        .attr("height", function (d) { return height - y(d.rate); });

      // add the x Axis
      svg.append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x));

      // add the y Axis
      svg.append("g")
        .call(d3.axisLeft(y));





    }
  </script>


</head>


<body>


  <div id="map" style="float:left" , width: 50%, height: 100%>
  </div>
  <div id="bars" style="float:left" , width: 50%, height: 100%>
  </div>

</body>

</html>
